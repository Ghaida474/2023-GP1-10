{% extends 'bu/components/base.html' %}
{% load static %}

    {% block content %}
						<!-- PAGE HEADER -->
                        <div class="page-header d-lg-flex d-block">
							<div class="page-leftheader">
								<div class="page-title">Change Password</div>
							</div>
							<div class="page-rightheader ms-md-auto">
							</div>
						</div>
						<!-- END PAGE HEADER -->
						
						<!-- ROW -->
						<div class="row">
							<!-- {% if messages %}
								<script>
								// Function to display messages, wait, and redirect
								function displayMessages() {
									// Display messages (you can customize this based on your message types)
									{% for message in messages %}
									alert('{{ message }}');
									{% endfor %}

									// Wait for 5 seconds and then redirect
									setTimeout(function() {
									window.location.href = 'target_page_url';
									}, 5000); // 5000 milliseconds (5 seconds)
								}
								window.addEventListener('load', displayMessages);
								</script>
							{% endif %} -->
							<!-- <p style="margin-left: 575px;">saldas</p> -->
							<div class="col-xl-8 col-lg-7">
								<div class="card"  style="width: 450px; margin-left: 390px; box-shadow:1px 1px 2px 1px #0084BD; background-color: #F5FBFF;">
									<div class="card-body">
										<div class="card-title"></div>
										<div class="row">
											<form method="post" enctype="multipart/form-data" name="form_type" value="form2">
                                                {% csrf_token %}
												<span class="error-message" style="color: red;">{{ form.non_field_errors }}</span> 
                                                
																						
														<div class="form-group">
															<label class="form-label">Current Password</label>
															<div class="input-group mb-4">
																<div class="input-group" id="Password-toggle">
																	<a href="" class="input-group-text">
																		<i class="fe fe-eye-off" aria-hidden="true"></i>
																	</a>
																	{{ form.current_password }}
																	<span class="error-message" style="color: red;">{{ form.current_password.errors }}</span>
																</div>
															</div> 
														</div>
													

														<div class="form-group">
															<label class="form-label">New Password</label>
															<div class="input-group mb-4">
																<div class="input-group" id="Password-toggle">
																	<a href="" class="input-group-text">
																		<i class="fe fe-eye-off" aria-hidden="true"></i>
																	</a>
																	{{ form.new_password }}
																	<span class="error-message" style="color: red;">{{ form.new_password.errors }}</span>
																</div> 
															</div> 
														</div>
																
														<div class="form-group">
															<label class="form-label">Confirm New Password</label>
															<div class="input-group mb-4">
																<div class="input-group" id="Password-toggle">
																	<a href="" class="input-group-text">
																		<i class="fe fe-eye-off" aria-hidden="true"></i>
																	</a>
																	{{ form.confirm_password }}
																	<span class="error-message" style="color: red;">{{ form.confirm_password.errors }}</span>	
																</div> 
															</div> 
														</div>
														
												<div class="card-footer text-center">
                                                    <button  type="submit" class="btn btn-lg btn-primary">Updated</button>
                                                    <a href="{% url 'business_unit_account:profile' %}"class="btn btn-lg btn-danger">Cancel</a>
                                                </div>
                                            
													<!-- </div> -->
											</form> 
										</div>
									</div>
								</div>											
							</div>
						</div>
							<div class="card"  style="width: 450px; margin-left: 390px; box-shadow:1px 1px 2px 1px #0084BD; background-color: #F5FBFF;">
								<div class="card-body">
									<div class="card-title"></div>
									<div class="row">
										<label class="form-label text-center" style="font-size: 20px;"> Instructions</label>
										<P> Please enter your current password and the new password should contain the following: </P>
										<ol style="margin-left: 16px;">
											<li>Should be at least 8 characters long.</li>
											<li>Have at least one capital letter.</li>
											<li>have at least one small letter.</li>
											<li>Have at least one digit.</li>
											<li>Have at least one special character ( @, $, !, %, *, ?, & ).</li>
										</ol>
									</div>
								</div>
							</div>
						</div>
						<!-- END ROW -->
						<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
						<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

						<script>
							$(document).ready(function() {
							// Current Password validation
							$('input[name="current_password"]').on('blur', function() {
								var currentPassword = $(this).val();
								if (currentPassword.length < 8) {
								$(this).addClass('is-invalid');
								$(this).siblings('.error-message').text('Current Password should be at least 8 characters long');
								} else {
								$(this).removeClass('is-invalid');
								$(this).siblings('.error-message').text('');
								}
							});

							// New Password validation
							$('input[name="new_password"]').on('blur', function() {
								var newPassword = $(this).val();
								var passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
								if (!passwordRegex.test(newPassword)) {
								$(this).addClass('is-invalid');
								$(this).siblings('.error-message').text('New Password should be at least 8 characters long, have at least one capital letter, one small letter, one digit, and one special character');
								} else {
								$(this).removeClass('is-invalid');
								$(this).siblings('.error-message').text('');
								}
							});

							// Confirm Password validation
							$('input[name="confirm_password"]').on('blur', function() {
								var newPassword = $('input[name="new_password"]').val();
								var confirmPassword = $(this).val();
								if (newPassword !== confirmPassword) {
								$(this).addClass('is-invalid');
								$(this).siblings('.error-message').text('Confirm Password should match New Password');
								} else {
								$(this).removeClass('is-invalid');
								$(this).siblings('.error-message').text('');
								}
							});

							// Form submission validation
							$('form[name="form_type"]').on('submit', function(e) {
								var currentPassword = $('input[name="current_password"]').val();
								var newPassword = $('input[name="new_password"]').val();
								var confirmPassword = $('input[name="confirm_password"]').val();

								if (currentPassword.length < 8 || newPassword.length < 8 || !newPassword.match(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/) || newPassword !== confirmPassword) {
								e.preventDefault();
								alert('Please fill in all the fields correctly');
								}
							});
							});

							</script>
								<script>
									$(document).ready(function() {
								$("#toggle-password-current").click(function() {
									togglePasswordVisibility($(this), $(this).parent().parent().next());
								});

								$("#toggle-password-new").click(function() {
									togglePasswordVisibility($(this), $(this).parent().parent().next());
								});

								$("#toggle-password-confirm").click(function() {
									togglePasswordVisibility($(this), $(this).parent().parent().next());
								});
							});

							function togglePasswordVisibility(eyeIcon, inputField) {
								eyeIcon.toggleClass("fa-eye fa-eye-slash");
								if (inputField.attr("type") === "password") {
									inputField.attr("type", "text");
								} else {
									inputField.attr("type", "password");
								}
							}
								</script>
								<script>
									$(document).ready(function() {
										setTimeout(function() {
											$('.alert').fadeOut('slow');
										}, 30000); // <-- time in milliseconds, 30000 ms = 0.5 min
									});
									</script>
								{% endblock %}

	
    {% block scripts %}
        <!-- THEME COLOR JS -->
		<script src="{% static 'assets/js/themeColors.js'%}"></script>
	{% endblock %}